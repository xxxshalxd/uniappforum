"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/http.js"),o=require("../../stores/user.js");if(!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-input")+e.resolveComponent("u-button")+e.resolveComponent("u-tag")+e.resolveComponent("u-modal"))()}Math||((()=>"../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-tag/u-tag.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-modal/u-modal.js"))();const u={__name:"user",setup(u){const s=o.useUserStore(),r=e.ref(!1),l=e.ref(!1),t=e.ref({username:"",password:""}),n=e.ref({username:"",password:"",confirmPassword:""}),v=e.ref([]),d=e.ref(""),i=e.ref(!1),p=e.ref(""),c=e.ref(""),m=()=>{r.value=!1,l.value=!1,d.value=""},f=()=>{r.value=!0},w=async()=>{try{const e=await a.http.post("/api/users/login",t.value);s.login(e.data),l.value=!0,g(),i.value=!0,p.value="登录成功",c.value="欢迎回来！"}catch(e){console.error("Login failed:",e),i.value=!0,p.value="登录失败",c.value=e.response.data||"登录失败，请重试"}},b=async()=>{if(n.value.password!==n.value.confirmPassword)return i.value=!0,p.value="注册失败",void(c.value="密码和确认密码不匹配");try{const e=await a.http.post("/api/users/register",n.value);s.login(e.data),m(),i.value=!0,p.value="注册成功",c.value="注册成功，请登录"}catch(e){console.error("Register failed:",e),i.value=!0,p.value="注册失败",c.value=e.response.data||"注册失败，请重试"}},g=async()=>{const e=s.userInfo.id;if(e)try{const o=await a.http.get(`/api/posts/user/${e}`);v.value=o.data}catch(o){console.error("Error fetching user posts:",o)}else console.log("No user is currently logged in.")},h=()=>{i.value=!1},y=async()=>{s.logout(),l.value=!1};return(a,o)=>e.e({a:e.p({title:"登录/注册","is-back":"false",hideBack:!0,"hide-back-button":!0}),b:!r.value&&!l.value},r.value||l.value?{}:{c:e.o((e=>t.value.username=e)),d:e.p({placeholder:"用户名",mode:"border",modelValue:t.value.username}),e:e.o((e=>t.value.password=e)),f:e.p({type:"password",placeholder:"密码",mode:"border",modelValue:t.value.password}),g:e.o(w),h:e.o(f)},{i:r.value},r.value?{j:e.o((e=>n.value.username=e)),k:e.p({placeholder:"用户名",mode:"border",modelValue:n.value.username}),l:e.o((e=>n.value.password=e)),m:e.p({type:"password",placeholder:"密码",mode:"border",modelValue:n.value.password}),n:e.o((e=>n.value.confirmPassword=e)),o:e.p({type:"password",placeholder:"确认密码",mode:"border",modelValue:n.value.confirmPassword}),p:e.o(b),q:e.o(m)}:{},{r:l.value},l.value?{s:e.p({text:"用户名",type:"success"}),t:e.t(e.unref(s).userInfo.username),v:e.o(y),w:e.f(v.value,((a,o,u)=>({a:e.t(a.title),b:e.t(a.content),c:a.id})))}:{},{x:d.value},d.value?{y:e.t(d.value)}:{},{z:e.o(h),A:e.o((e=>i.value=e)),B:e.p({title:p.value,content:c.value,modelValue:i.value})})}},s=e._export_sfc(u,[["__scopeId","data-v-07baf60b"]]);wx.createPage(s);
